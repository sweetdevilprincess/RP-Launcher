# Agent Analysis Cache Specification

Complete specification for the `agent_analysis.md` cache file that stores results from all DeepSeek agent systems with easy expandability.

---

## üìÅ File Location

**Path**: `{RP_DIR}/state/agent_analysis.md`

**Lifecycle**:
- Created automatically on first run
- Persists across sessions
- Cleared on `/new` command (new RP session)
- Loaded on `/continue` command (resume session)
- Updated after every response

---

## üéØ Purpose

Store analysis results from all DeepSeek agents to provide:
1. **Session continuity** - Cache survives app restarts
2. **Context for Claude** - Inject relevant analysis into prompts
3. **Debugging visibility** - Human-readable analysis results
4. **Freshness tracking** - Know when cache is stale
5. **Easy expansion** - Add new agents without restructuring

---

## üìä Current Agent Systems (11 Total)

### Background Analysis Agents (6 agents)
Run after Response N while user types Message N+1:
1. **Response Analyzer** - Scene classification, character identification, pacing, variety
2. **Memory Creation** - Extract memorable moments from response
3. **Relationship Analysis** - Preference matching and tier changes
4. **Plot Thread Detection** - Identify new/mentioned/resolved threads
5. **Knowledge Base Extraction** - Extract world-building facts
6. **Contradiction Detection** - Optional fact-checking (Phase 2.3)

### Immediate Context Agents (4 agents)
Run before Response N+1 (quick, user sees latency):
7. **Quick Entity Analysis** - Identify entities mentioned in user message
8. **Fact Extraction** - Extract facts for Tier 2 entities
9. **Memory Extraction** - Get relevant memories per character
10. **Plot Thread Extraction** - Extract 2-5 relevant threads from master

### Creation Agents (1 agent)
Run as background tasks when triggered:
11. **Entity Card Generation** - Create new entity cards for mentioned characters

---

## üìù File Structure Template

The cache uses a **modular section-based format** that's easy to expand. Each agent gets its own section following a consistent template.

```markdown
# Agent Analysis Cache
<!-- Auto-generated by RP Claude Code Agent System -->

## üîç Cache Metadata
[Session tracking and freshness info]

## üìä BACKGROUND ANALYSIS (Response N)
[6 background agents, each in its own section]

## ‚ö° IMMEDIATE CONTEXT (For Response N+1)
[4 immediate agents, each in its own section]

## üèóÔ∏è CREATION TASKS
[1 creation agent + status of background tasks]

## üìà Performance Summary
[Aggregated stats across all agents]
```

---

## üìÑ Complete Cache File Format

```markdown
# Agent Analysis Cache
<!-- Auto-generated by RP Claude Code Agent System -->

## üîç Cache Metadata

**Session ID**: [session_uuid]
**Current Response Number**: N
**Last Analysis**: Response N at [timestamp]
**Next Response**: N+1
**Cache Status**: ‚úÖ Fresh | ‚ö†Ô∏è Stale (>5 responses behind) | ‚ùå Empty
**Total Agents**: 11 (6 background, 4 immediate, 1 creation)
**Last Run**: 10/11 successful (1 skipped)

---

## üìä BACKGROUND ANALYSIS (Response N)
<!-- Analysis of Response N, completed while user typed Message N+1 -->
<!-- Execution Time: ~30 seconds (hidden from user) -->
<!-- Cost: ~$0.00085 -->

### 1Ô∏è‚É£ Response Analyzer
<!-- Agent ID: response_analyzer | Duration: 15000ms | Cost: $0.0001 -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚úÖ Success | ‚ö†Ô∏è Partial | ‚ùå Failed
**Phase**: 0.4 (Background Analysis System)

#### Scene Classification
- **Type**: dialogue
- **Pacing**: medium
- **Tension**: 6/10
- **Word Count**: 450

#### Characters
- **In Scene**: Marcus, Lily
- **Mentioned But Absent**: David, Sarah
- **New Characters Introduced**: None

#### Location
- **Current Location**: Coffee Corner Cafe
- **Location Changed**: No

#### Timeline
- **Time Passed**: 30 minutes
- **Timestamp**: Tuesday 3:00 PM
- **Day/Chapter**: Chapter 5, Response 120

#### Variety & Pacing Alerts
- **Last 5 Scene Types**: dialogue, dialogue, action, dialogue, dialogue
- **Variety Alert**: ‚ö†Ô∏è Last 4 of 5 responses are dialogue-heavy
- **Pacing Note**: Tension steady at 6/10 for 3 responses
- **Recommendation**: Consider action or world-building scene

---

### 2Ô∏è‚É£ Memory Creation
<!-- Agent ID: memory_creation | Duration: 5000ms | Cost: $0.0001 -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 1.1 (Memory Extraction System)

#### Memories Extracted: 2

**Memory #1**: Marcus Vulnerability Moment
- **Characters**: Marcus, Lily
- **Location**: Coffee Corner Cafe
- **Type**: revelation
- **Significance**: 8/10
- **Emotional Tone**: vulnerable, hopeful
- **Summary**: Marcus revealed his fear of commitment from parents' divorce
- **Quote**: "I've never told anyone this before, but..."
- **Tags**: #vulnerability #backstory #marcus #lily
- **File Created**: `memories/marcus/MEM-120-vulnerability.md`

**Memory #2**: Lily Empathy Response
- **Characters**: Lily
- **Location**: Coffee Corner Cafe
- **Type**: character_moment
- **Significance**: 6/10
- **Emotional Tone**: empathetic
- **Summary**: Lily showed understanding of Marcus's fears
- **Quote**: "It's okay to be scared. That just means it matters."
- **Tags**: #empathy #lily #relationship_development
- **File Created**: `memories/lily/MEM-120-empathy.md`

---

### 3Ô∏è‚É£ Relationship Analysis
<!-- Agent ID: relationship_analysis | Duration: 5000ms | Cost: $0.00015 -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 1.2 (Dynamic Relationship System)

#### Interactions Analyzed: 1

**Marcus ‚Üî Lily**:
- **Current Tier**: Acquaintance (Score: 28/100)
- **Previous Score**: 18/100
- **Change**: +10 points
- **Trigger**: Lily showed empathy (Marcus likes: emotional_intelligence +10)

**Preference Matches**:
- ‚úÖ Lily showed empathy (Marcus likes: emotional_intelligence +10)

**Tier Change**: No (still Acquaintance: 11-30)
- **Next Tier**: Friend (31-60) - Need +3 more points

**Notes**: Relationship progressing naturally. Marcus opening up increases likelihood of tier change soon.

---

### 4Ô∏è‚É£ Plot Thread Detection
<!-- Agent ID: plot_thread_detection | Duration: 5000ms | Cost: $0.0002 -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 2.1 (Plot Thread Tracker)

#### New Plot Threads: 1

**THREAD-025**: Marcus's Commitment Issues
- **Status**: Active
- **Priority**: Medium
- **Introduced**: Chapter 5, Response 120
- **Time Sensitive**: No
- **Characters**: Marcus, (potential: Lily)
- **Tags**: #character_development #romance #backstory
- **File**: `state/plot_threads_master.md` (line 245)

#### Mentioned Threads: 2

**THREAD-001**: Marcus Job Interview at Morrison Law Firm
- **Last Mentioned**: Response 120 (current)
- **Responses Since Last Mention**: 0 (just mentioned)
- **Consequence Status**: ‚ö†Ô∏è Threshold approaching (5 responses until hired elsewhere)
- **Update**: Marcus mentioned "waiting to hear back"

**THREAD-018**: Lily's Photography Exhibition
- **Last Mentioned**: Response 120 (current)
- **Responses Since Last Mention**: 0
- **Consequence Status**: ‚úÖ On track (exhibition in 15 responses)
- **Update**: Lily briefly mentioned "getting ready for the show"

#### Resolved Threads: 0

**Master File Updated**: `state/plot_threads_master.md`

---

### 5Ô∏è‚É£ Knowledge Base Extraction
<!-- Agent ID: knowledge_extraction | Duration: 3000ms | Cost: $0.0001 -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 2.2 (Knowledge Base System)

#### Facts Extracted: 3

**Fact #1**: Location Detail
- **Category**: Locations
- **Subject**: Coffee Corner Cafe
- **Fact**: Espresso machine broken for 2 weeks
- **Source**: Chapter 5, Response 120
- **Confidence**: High

**Fact #2**: Character Background
- **Category**: Characters
- **Subject**: Marcus
- **Fact**: Parents divorced when he was 12, causing trust issues
- **Source**: Chapter 5, Response 120
- **Confidence**: High (direct revelation)

**Fact #3**: Cultural Detail
- **Category**: Setting
- **Subject**: Local Art Scene
- **Fact**: Photography exhibitions held at Downtown Gallery monthly
- **Source**: Chapter 5, Response 120
- **Confidence**: Medium (casual mention)

**Knowledge Base Updated**: `state/knowledge_base.md`

---

### 6Ô∏è‚É£ Contradiction Detection (Optional)
<!-- Agent ID: contradiction_detection | Duration: 2000ms | Cost: $0.0002 -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚è≠Ô∏è Skipped (Phase 2.3 not implemented yet)
**Phase**: 2.3 (Contradiction Detection - Optional)

**Note**: This agent will be enabled in Phase 2.3. Currently skipped to save cost.

---

## ‚ö° IMMEDIATE CONTEXT (For Response N+1)
<!-- Quick context gathering before Response N+1 -->
<!-- Execution Time: ~5 seconds (user sees this) -->
<!-- Cost: ~$0.00085 -->

### 7Ô∏è‚É£ Quick Entity Analysis
<!-- Agent ID: quick_entity_analysis | Duration: 3000ms | Cost: $0.00005 -->

**User Message**: N+1
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 0.5 (Context Intelligence)

#### Entities Detected

**Scene Participants** (Tier 1 - Full Cards):
- Marcus (already loaded, `entities/Marcus.md`)
- Lily (already loaded, `entities/Lily.md`)

**Mentioned But Absent** (Tier 2 - Extract Facts):
- David (mentioned by name, `entities/David.md`)
- Sarah (mentioned by name, `entities/Sarah.md`)

**Locations Mentioned**:
- Coffee Corner Cafe (current location, `locations/Coffee_Corner_Cafe.md`)
- Morrison Law Firm (mentioned in context, `locations/Morrison_Law_Firm.md`)

**Action**: Load Tier 1 full cards, extract Tier 2 facts

---

### 8Ô∏è‚É£ Fact Extraction (Tier 2 Entities)
<!-- Agent ID: fact_extraction | Duration: 2000ms | Cost: $0.0002 -->

**User Message**: N+1
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 0.5 (Context Intelligence)

#### David (Mentioned But Absent)
**Card**: `entities/David.md` (2,200 tokens)
**Extracted Facts** (5 key points):
1. Marcus's best friend since college
2. Works as software engineer at TechCorp
3. Known for being blunt and direct
4. Doesn't like Lily (thinks she's "too flighty")
5. Recently got engaged to Amy

**Token Reduction**: 2,200 ‚Üí 60 tokens (97% reduction)

#### Sarah (Mentioned But Absent)
**Card**: `entities/Sarah.md` (1,800 tokens)
**Extracted Facts** (5 key points):
1. Marcus's younger sister
2. Graduate student studying psychology
3. Close relationship with Marcus, worries about him
4. Met Lily once at a party, liked her
5. Currently dealing with thesis stress

**Token Reduction**: 1,800 ‚Üí 55 tokens (97% reduction)

**Total Tier 2 Reduction**: 4,000 ‚Üí 115 tokens (97% reduction)

---

### 9Ô∏è‚É£ Memory Extraction
<!-- Agent ID: memory_extraction | Duration: parallel | Cost: $0.0003 -->

**User Message**: N+1
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 1.1 (Memory Extraction System)

#### Marcus - Relevant Memories (3 from 45 total)

**MEM-120**: Vulnerability Moment
- **When**: Chapter 5, Response 120 (just now)
- **Location**: Coffee Corner Cafe
- **Significance**: 8/10
- **Why Relevant**: Just shared, colors current interaction
- **Summary**: Revealed fear of commitment from parents' divorce

**MEM-087**: First Coffee with Lily
- **When**: Chapter 4, Response 87
- **Location**: Coffee Corner Cafe
- **Significance**: 7/10
- **Why Relevant**: Foundation of their developing connection
- **Summary**: First real conversation, discovered shared interests

**MEM-012**: Parents' Divorce Memory
- **When**: Chapter 1, Response 12 (backstory)
- **Location**: Childhood home
- **Significance**: 9/10
- **Why Relevant**: Root of commitment issues just revealed
- **Summary**: Watched parents fight, felt powerless

**Token Reduction**: 8,500 ‚Üí 320 tokens (96% reduction)

#### Lily - Relevant Memories (2 from 28 total)

**MEM-087**: First Coffee with Marcus
- **When**: Chapter 4, Response 87
- **Location**: Coffee Corner Cafe
- **Significance**: 7/10
- **Why Relevant**: Shared memory with Marcus
- **Summary**: Enjoyed talking to Marcus, felt understood

**MEM-105**: Past Relationship Trauma
- **When**: Chapter 5, Response 105 (backstory)
- **Significance**: 8/10
- **Why Relevant**: Makes her empathy for Marcus more meaningful
- **Summary**: Ex-boyfriend was emotionally unavailable, hurt her deeply

**Token Reduction**: 6,200 ‚Üí 280 tokens (95% reduction)

**Total Memory Reduction**: 14,700 ‚Üí 600 tokens (96% reduction)

---

### üîü Plot Thread Extraction
<!-- Agent ID: plot_thread_extraction | Duration: parallel | Cost: $0.0003 -->

**User Message**: N+1
**Timestamp**: [datetime]
**Status**: ‚úÖ Success
**Phase**: 2.1 (Plot Thread Tracker)

#### Threads Loaded: 3 (from 25 active threads)

**THREAD-001**: Marcus Job Interview ‚ö†Ô∏è CRITICAL
- **Status**: Active (CONSEQUENCE IMMINENT)
- **Priority**: High
- **Last Mentioned**: Response 120 (current)
- **Consequence Countdown**: 5 responses until firm hires someone else
- **Why Loaded**: Critical urgency, mentioned in conversation
- **Recommendation**: Address in next 5 responses or consequence triggers

**THREAD-018**: Lily's Photography Exhibition
- **Status**: Active
- **Priority**: Medium
- **Last Mentioned**: Response 120 (current)
- **Time Sensitive**: YES (15 responses until exhibition)
- **Why Loaded**: Recently mentioned, relevant to Lily

**THREAD-025**: Marcus's Commitment Issues (NEW)
- **Status**: Active
- **Priority**: Medium
- **Introduced**: Response 120 (just now)
- **Time Sensitive**: NO
- **Why Loaded**: Just introduced, colors current scene

#### Threads Monitored (Not Loaded): 22
- THREAD-003, THREAD-007, THREAD-012 [+19 more tracked but not loaded]

**Token Reduction**: 5,500 ‚Üí 800 tokens (85% reduction)

---

## üèóÔ∏è CREATION TASKS

### 1Ô∏è‚É£1Ô∏è‚É£ Entity Card Generation
<!-- Agent ID: entity_card_generation | Background Task Queue -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚úÖ All tasks completed
**Phase**: 0.2 (Entity Card Management)

#### Cards Generated This Response: 0

No new entities detected requiring card generation.

#### Pending Tasks: 0

Queue is empty.

#### Recent Completions (Last 5)

**1. Marcus** - Generated Chapter 5, Response 115
- **Task ID**: entity_card_Marcus_1731600000
- **Duration**: 14,500ms
- **Status**: ‚úÖ Completed
- **File**: `entities/Marcus.md`

**2. Lily** - Generated Chapter 4, Response 87
- **Task ID**: entity_card_Lily_1731590000
- **Duration**: 13,800ms
- **Status**: ‚úÖ Completed
- **File**: `entities/Lily.md`

**3. David** - Generated Chapter 3, Response 65
- **Task ID**: entity_card_David_1731580000
- **Duration**: 15,200ms
- **Status**: ‚úÖ Completed
- **File**: `entities/David.md`

**4. Sarah** - Generated Chapter 3, Response 70
- **Task ID**: entity_card_Sarah_1731582000
- **Duration**: 14,100ms
- **Status**: ‚úÖ Completed
- **File**: `entities/Sarah.md`

**5. Amy** - Generated Chapter 2, Response 45
- **Task ID**: entity_card_Amy_1731570000
- **Duration**: 13,500ms
- **Status**: ‚úÖ Completed
- **File**: `entities/Amy.md`

#### Background Task Queue Stats
- **Total Cards Generated**: 23
- **Failed Tasks**: 1 (low balance error)
- **Average Generation Time**: 14,200ms
- **Queue Capacity**: 50 tasks
- **Concurrent Workers**: 4

---

## üìà Performance Summary

### Background Analysis (Response N)
- **Total Duration**: 30,000ms (30 seconds, hidden from user)
- **Total Cost**: $0.00075 (6 agents, 1 skipped)
- **Agents Run**: 5/6 successful (1 skipped by design)
- **Failures**: 0

### Immediate Context (Response N+1)
- **Total Duration**: 5,000ms (5 seconds, user sees this)
- **Total Cost**: $0.00085
- **Agents Run**: 4/4 successful
- **Failures**: 0

### Creation Tasks (Background)
- **Pending**: 0 tasks
- **Running**: 0 tasks
- **Recent Completions**: 5 cards

### Token Reduction Achieved
- **Tier 2 Entities**: 4,000 ‚Üí 115 tokens (97% reduction)
- **Memories**: 14,700 ‚Üí 600 tokens (96% reduction)
- **Plot Threads**: 5,500 ‚Üí 800 tokens (85% reduction)
- **Total Reduction**: 24,200 ‚Üí 1,515 tokens (94% reduction)
- **Tokens Saved**: 22,685 tokens

### Cost-Benefit Analysis
- **DeepSeek Cost**: $0.0016 per turn (both phases)
- **Claude Token Savings**: $0.068 per turn (22,685 tokens √ó $3/million)
- **ROI**: 42.5:1
- **Net Savings**: $0.0664 per turn

---

## üîÑ Cache Freshness Rules

### Fresh Cache (‚úÖ)
- Background analysis completed for Response N
- Immediate context ready for Response N+1
- All agents succeeded (or intentionally skipped)
- Cache updated within last response

### Stale Cache (‚ö†Ô∏è)
- Cache is >5 responses behind current
- Some agents failed (partial results)
- User used `/continue` and cache needs rebuild

### Empty Cache (‚ùå)
- New session (no previous responses)
- User used `/new` command
- Cache file doesn't exist

---

## üîß Integration Points

### After Claude Response N
1. **Trigger**: Claude finishes Response N
2. **Action**: Run 6 background agents concurrently (30s hidden)
3. **Update**: Background Analysis section of cache
4. **Save**: Write updated cache to disk

### Before Claude Response N+1
1. **Trigger**: User sends Message N+1
2. **Action**: Run 4 immediate agents concurrently (5s visible)
3. **Update**: Immediate Context section of cache
4. **Inject**: Add relevant context to Claude prompt
5. **Save**: Write updated cache to disk

### On `/new` Command
1. **Action**: Clear entire cache file
2. **Create**: New empty cache with metadata
3. **Status**: Set to ‚ùå Empty

### On `/continue` Command
1. **Action**: Load existing cache from disk
2. **Check**: Verify cache freshness
3. **Rebuild**: If stale (>5 responses behind), rerun agents
4. **Status**: Set to ‚úÖ Fresh or ‚ö†Ô∏è Stale

---

## üéØ Claude Injection Format (Condensed)

When injecting context into Claude prompt, use condensed format (~300-400 tokens):

```markdown
<!-- AGENT CONTEXT (Response N ‚Üí N+1) -->

**Scene Analysis**: Dialogue, Tension 6/10, ‚ö†Ô∏è 4/5 last responses dialogue-heavy
**Characters**: In Scene (Marcus, Lily), Mentioned (David, Sarah)
**Memories Created**: Marcus vulnerability (8/10), Lily empathy (6/10)
**Relationships**: Marcus ‚Üî Lily +10 (now 28/100, Acquaintance)
**Plot Threads**: NEW THREAD-025 (Marcus commitment issues), THREAD-001 ‚ö†Ô∏è job interview (5 responses until consequence), THREAD-018 Lily exhibition (15 responses)
**Knowledge Added**: Marcus backstory (parents divorced at 12), cafe espresso broken 2 weeks

**Context for N+1**:
- Mentioned: David (best friend, doesn't like Lily), Sarah (sister, likes Lily)
- Marcus Memories: MEM-120 vulnerability just now, MEM-087 first coffee, MEM-012 divorce trauma
- Lily Memories: MEM-087 first coffee, MEM-105 past relationship trauma
- Active Threads: THREAD-001 ‚ö†Ô∏è urgent, THREAD-018 medium, THREAD-025 new

<!-- END AGENT CONTEXT -->
```

---

## ‚ûï Adding New Agents (Easy Expansion)

To add a new agent to the cache, follow this template:

### Template for Background Agents

```markdown
### [NUMBER]Ô∏è‚É£ [Agent Name]
<!-- Agent ID: agent_id | Duration: XXXXms | Cost: $X.XXXXX -->

**Response Number**: N
**Timestamp**: [datetime]
**Status**: ‚úÖ Success | ‚ö†Ô∏è Partial | ‚ùå Failed | ‚è≠Ô∏è Skipped
**Phase**: [Phase number] ([Phase name])

#### [Section 1 Title]
[Agent-specific output]

#### [Section 2 Title]
[Agent-specific output]

**[Summary Line]**: [Key outcome]

---
```

### Template for Immediate Agents

```markdown
### [NUMBER]Ô∏è‚É£ [Agent Name]
<!-- Agent ID: agent_id | Duration: XXXXms | Cost: $X.XXXXX -->

**User Message**: N+1
**Timestamp**: [datetime]
**Status**: ‚úÖ Success | ‚ö†Ô∏è Partial | ‚ùå Failed
**Phase**: [Phase number] ([Phase name])

#### [Section Title]
[Agent-specific output]

**Token Reduction**: [before] ‚Üí [after] tokens ([percent]% reduction)

---
```

### Example: Adding New "Emotion Tracker" Agent

```markdown
### 7Ô∏è‚É£ Emotion Tracker
<!-- Agent ID: emotion_tracker | Duration: 4000ms | Cost: $0.0001 -->

**Response Number**: N
**Timestamp**: 2025-10-14 16:45:30
**Status**: ‚úÖ Success
**Phase**: 1.4 (Emotion Tracking System)

#### Emotions Detected

**Marcus**:
- **Primary**: Vulnerability (8/10 intensity)
- **Secondary**: Hope (5/10 intensity)
- **Shift**: From guarded ‚Üí vulnerable (major shift)

**Lily**:
- **Primary**: Empathy (7/10 intensity)
- **Secondary**: Concern (6/10 intensity)
- **Shift**: Steady (no major change)

**Overall Scene Emotion**: Intimate, vulnerable, cautiously hopeful

---
```

Just add the new section to the appropriate category (Background, Immediate, or Creation), update the metadata counts, and the system handles the rest!

---

## üìä Success Criteria

### Quality Metrics
- ‚úÖ All 11 agents execute successfully per turn (or intentionally skip)
- ‚úÖ Cache saved to disk after every response
- ‚úÖ Cache loads correctly on `/continue`
- ‚úÖ Cache clears correctly on `/new`
- ‚úÖ Token reduction >90% compared to full load
- ‚úÖ ROI >30:1 (DeepSeek cost vs Claude savings)

### Performance Metrics
- ‚úÖ Background agents complete in <35 seconds
- ‚úÖ Immediate agents complete in <6 seconds
- ‚úÖ User perceived latency <30 seconds total
- ‚úÖ No blocking on background analysis

### Reliability Metrics
- ‚úÖ Partial success mode enabled (some agents fail, others succeed)
- ‚úÖ Cache survives app crashes/restarts
- ‚úÖ Graceful degradation if DeepSeek unavailable
- ‚úÖ Low balance protection (402 errors don't retry)

### Expandability
- ‚úÖ New agents can be added by following template
- ‚úÖ No restructuring needed when adding agents
- ‚úÖ Modular section format supports any agent type
- ‚úÖ Performance summary auto-calculates from all sections

---

## üöÄ Implementation Checklist

### Phase 1: Agent Coordinator Enhancement
- [ ] Add `save_to_file(cache_file: Path)` method to AgentCoordinator
- [ ] Add `load_from_file(cache_file: Path)` method to AgentCoordinator
- [ ] Add markdown formatting for all 11 agent types
- [ ] Add template-based section generator (easy to extend)
- [ ] Add condensed injection format generator
- [ ] Add cache freshness checking

### Phase 2: Integration
- [ ] Modify orchestrator to call background agents after Response N
- [ ] Modify orchestrator to call immediate agents before Response N+1
- [ ] Add cache loading in `/continue` command
- [ ] Add cache clearing in `/new` command
- [ ] Add cache injection into prompt builder

### Phase 3: Testing
- [ ] Test cache persistence across restarts
- [ ] Test cache freshness detection
- [ ] Test partial agent failures
- [ ] Test token reduction metrics
- [ ] Test ROI calculations
- [ ] Test adding new agent (verify template works)

---

**Summary**: 11 current agents (6 background, 4 immediate, 1 creation), modular template format for easy expansion, 94% token reduction, 42:1 ROI, session-persistent cache with `/new` and `/continue` integration.
